# Evento Monorepo

White-label Flutter app monorepo with core package and shell app structure.

## Structure

```
evento/
├── core/              # Core Flutter package (shared logic + UI)
│   ├── lib/
│   ├── assets/
│   └── pubspec.yaml
│
└── shell/             # White-label app + build automation
    ├── android/
    ├── ios/
    ├── lib/
    │   ├── main.dart
    │   └── app_config.g.dart  # Generated by build script
    ├── assets/
    │   └── generated/        # Downloaded assets (not committed)
    ├── configs/               # Per-event YAML configs
    │   ├── melb2026.yaml
    │   └── gc2026.yaml
    ├── tool/
    │   └── build_app.dart     # Main build/configuration script
    ├── scripts/               # Helper build scripts
    │   ├── build_melb2026.sh
    │   └── build_gc2026.sh
    ├── builds/                # Output AAB/IPA files
    └── pubspec.yaml
```

## Quick Start

### 1. Setup

```bash
# Install dependencies for core package
cd core
flutter pub get

# Install dependencies for shell app
cd ../shell
flutter pub get
```

### 2. Build for Development (Simulator Testing)

This builds the app with your event configuration and prepares it for running on a simulator/emulator.

#### Example: Building Melbourne 2026 for Simulator

```bash
cd shell

# Step 1: Run the build script in dev mode
# This will:
# - Download assets (icon, splash, Firebase configs) from cloud URLs
# - Generate app configuration from YAML
# - Update Android/iOS bundle IDs and app names
# - Generate icons and splash screens
./scripts/build.sh configs/melb2026.yaml --dev

# Or use the build script directly:
02

# Step 2: Run on simulator/emulator
# For iOS Simulator:
flutter run

# For Android Emulator:
flutter run

# Or specify a device:
flutter devices                    # List available devices
flutter run -d "iPhone 15 Pro"    # iOS
flutter run -d "Pixel 7"          # Android
```

#### What happens in dev mode:
- ✅ Downloads assets from cloud URLs (icon, splash, Firebase configs)
- ✅ Generates `lib/app_config.g.dart` from YAML config
- ✅ Updates Android/iOS bundle IDs and app names
- ✅ Generates app icons and splash screens
- ✅ Configures Android signing (optional for dev)
- ⚠️ Does NOT build release artifacts (AAB/IPA)

### 3. Build for Release (Store Upload)

This builds production-ready artifacts (AAB for Google Play, IPA for App Store).

#### Example: Building Melbourne 2026 for Release

```bash
cd shell

# Step 1: Run the build script in release mode
# This will do everything from dev mode PLUS:
# - Build Android App Bundle (AAB)
# - Build iOS App Archive (IPA)
./scripts/build.sh configs/melb2026.yaml --release

# Or use the build script directly:
dart run tool/build_app.dart configs/melb2026.yaml --release
```

#### What happens in release mode:
- ✅ Everything from dev mode
- ✅ Builds Android App Bundle (AAB) → `builds/melb2026/melb2026.aab`
- ✅ Builds iOS App Archive (IPA) → `builds/melb2026/melb2026.ipa`
- ✅ Uses release signing configuration (from `key_properties_url` or individual fields)

#### Output Location:
Built artifacts will be in `shell/builds/<event_name>/`:
- `melb2026.aab` - Android App Bundle (upload to Google Play Console)
- `melb2026.ipa` - iOS App Archive (upload to App Store Connect)

#### Uploading to Stores:

**Google Play Store:**
1. Go to [Google Play Console](https://play.google.com/console)
2. Select your app
3. Go to Production → Create new release
4. Upload `builds/melb2026/melb2026.aab`

**Apple App Store:**
1. Use Xcode Organizer or `xcrun altool`:
   ```bash
   xcrun altool --upload-app \
     --type ios \
     --file builds/melb2026/melb2026.ipa \
     --apiKey YOUR_API_KEY \
     --apiIssuer YOUR_ISSUER_ID
   ```
2. Or use Transporter app or App Store Connect website

## Configuration

Each event has a YAML config file in `shell/configs/`. Example:

```yaml
app_name: "Melbourne Marathon 2026"
app_id: 91
onesignal_id: "31c166a5-3735-4ed7-8bea-b3de9b96a687"
single_event_url: "https://eventotracker.com/api/v3/api.cfm/config"
single_event_id: "449"
android_bundle_id: "nz.netproject.eventotracker.melb2026"
ios_bundle_id: "nz.netproject.eventotracker.melb2026"
icon_url: "https://example.com/icon.png"  # Optional
splash_url: "https://example.com/splash.png"  # Optional
```

## Build Script Features

The `tool/build_app.dart` script:

1. ✅ Reads YAML config file
2. ✅ Generates `lib/app_config.g.dart` with app configuration
3. ✅ Updates Android bundle ID and app name
4. ✅ Updates iOS bundle ID and app name
5. ✅ Downloads icons/splash from URLs (if provided)
6. ✅ Builds AAB/IPA files in release mode
7. ✅ Organizes builds in `builds/<event_name>/` directory

## Adding a New Event

1. Create a new YAML config in `shell/configs/`:
   ```bash
   cp shell/configs/melb2026.yaml shell/configs/new_event.yaml
   ```

2. Edit the config with your event details

3. Build using the generic build script:
   ```bash
   ./scripts/build.sh configs/new_event.yaml --dev    # For testing
   ./scripts/build.sh configs/new_event.yaml --release  # For release
   ```

## Development Workflow

1. **Core Package Development**: Edit code in `core/lib/`
2. **Shell App Development**: Edit code in `shell/lib/`
3. **Testing**: Run build script with `--dev` flag, then `flutter run`
4. **Release**: Run build script with `--release` flag

## Notes

- The `builds/` directory and `assets/generated/` are gitignored
- `app_config.g.dart` is generated and should not be edited manually
- Each event gets its own bundle ID and can be installed side-by-side
- Icons and splash screens are downloaded from cloud URLs and automatically generated for Android/iOS during build
- Firebase config files (`google-services.json` and `GoogleService-Info.plist`) are downloaded from cloud URLs during build
